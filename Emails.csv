import streamlit as st
import openai
import csv
import os

# Page settings
st.set_page_config(page_title="EliteCV – AI CV Reviewer", page_icon=":briefcase:")

# Title
st.title("EliteCV – AI CV Reviewer")
st.subheader("Get instant professional feedback on your CV")

# API Key setup
openai.api_key = st.secrets["OPENAI_API_KEY"]

# --- Email Capture ---
email = st.text_input("Enter your email to receive feedback")

if email and "@" in email:
    with open("emails.csv", "a", newline="") as file:
        writer = csv.writer(file)
        writer.writerow([email])
else:
    st.warning("Please enter a valid email address to continue.")

# --- CV Input ---
cv_text = st.text_area("Paste your CV content below", height=300)

if st.button("Review My CV"):
    if not email or "@" not in email:
        st.warning("You must enter a valid email before reviewing.")
    elif not cv_text.strip():
        st.warning("Please paste your CV content.")
    else:
        with st.spinner("Reviewing your CV..."):
            prompt = f"Please review the following CV and give detailed, professional feedback:\n\n{cv_text}"

            response = openai.ChatCompletion.create(
                model="gpt-3.5-turbo",
                messages=[{"role": "user", "content": prompt}],
                temperature=0.7,
                max_tokens=800,
            )

            feedback = response['choices'][0]['message']['content']
            st.success("Here's your AI-generated CV feedback:")
            st.write(feedback) 
